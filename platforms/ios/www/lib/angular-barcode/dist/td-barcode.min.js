"use strict";angular.module("td.barcode",[]).directive("tdBarcode",function(){return{restrict:"E",scope:{config:"="},template:'<canvas ng-show="!error.show"></canvas><span ng-if="error.show">Barcode error: {{error.msg}}</span>',link:function(r,e){function n(r,e){for(var n=e.split(" "),o={},i=0;i<n.length;i++)if(n[i]){var t=n[i].indexOf("=");t==-1?o[n[i]]=r.value(!0):o[n[i].substr(0,t)]=r.value(n[i].substr(t+1))}return o}function o(r){var e=null;if("string"==typeof r)e=r;else if(r.stack)e=r.message+" "+r.stack;else{var n="";r.fileName&&(n+=r.fileName+" "),r.lineNumber&&(n+="[line "+r.lineNumber+"] ",e=n+(n?": ":"")+r.message)}return e}var i=e.children().eq(0);r.error={show:!1,msg:null},r.render=function(){var e=new BWIPJS,t="1"===r.config.rendering?1:0;BWIPJS.ft_monochrome(t),r.config.bgColor?e.bitmap(new Bitmap(r.config.bgColor)):e.bitmap(new Bitmap);var a=n(e,r.config.options);void 0!==r.config.altText&&(a.alttext=e.value(r.config.altText)),e.push(r.config.text),e.push(a),e.scale(r.config.scale.x,r.config.scale.y);var c=void 0!==r.config.rotation?r.config.rotation:"N";e.call(r.config.type,function(n){n?(r.error.msg=o(n),r.error.show=!0):(r.error.show=!1,r.error.msg=null,e.bitmap().show(i[0],c))})},r.$watch("config",function(e){void 0!==e&&null!==e&&r.render()},!0)}}});